<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Movie Detail</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/css/movieCardDetail.css}">
    <link rel="stylesheet" th:href="@{/css/movieCardGradeIcon.css}">
    <style>

    </style>
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>

<div class="container mt-5">
    <div class="row justify-content-center">

<!--        &lt;!&ndash; 영화 상세보기 카드 &ndash;&gt;-->
<!--        <div class="col-lg-10">-->
<!--            <div class="movie-detail-card">-->
<!--                <div class="row">-->
<!--                    <div class="col-md-4 text-center">-->
<!--                        <img th:src="@{${movie.posterImageUrl}}" class="img-fluid poster-image" alt="포스터 이미지">-->
<!--                    </div>-->
<!--                    <div class="col-md-8">-->
<!--                        <h2 class="mb-3" th:text="${movie.movieName}">영화 제목</h2>-->
<!--                        <ul class="list-unstyled">-->
<!--                            <li><strong>등급:</strong> <span th:text="${movie.rating}"></span></li>-->
<!--                            <li><strong>러닝타임:</strong> <span th:text="${movie.runtime}"></span>분</li>-->
<!--                            <li><strong>장르:</strong> <span th:text="${movie.genreName}"></span></li>-->
<!--                            <li><strong>감독:</strong> <span th:text="${movie.directorName}"></span></li>-->
<!--                            <li><strong>제작사:</strong> <span th:text="${movie.companys}"></span></li>-->
<!--                            <li><strong>개봉일:</strong> <span th:text="${movie.openDate}"></span></li>-->
<!--                            <li><strong>누적관객수:</strong> <span th:text="${movie.audiAcc}"></span>명</li>-->
<!--                            <li><strong>매출액:</strong> <span th:text="${movie.salesAcc}"></span></li>-->
<!--                        </ul>-->
<!--                        <hr>-->
<!--                        <p th:text="${movie.plot}" class="text-muted">줄거리</p>-->
<!--                        <div class="d-flex gap-3 mt-4">-->
<!--                            <a href="/" class="btn btn-secondary btn-custom px-4">홈으로</a>-->
<!--                            <a th:if="${movie.status.name() != 'PREV'}"-->
<!--                               th:href="@{/reservation(movieId=${movie.id})}"-->
<!--                               class="btn btn-success btn-custom px-4">예매하기</a>-->
<!--                            <button th:if="${movie.status.name() == 'PREV'}"-->
<!--                                    class="btn btn-secondary btn-custom px-4"-->
<!--                                    disabled>개봉 예정</button>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->

        <!-- 영화 상세보기 카드 + 등급 -->
        <div class="col-lg-10">
            <div class="movie-detail-card">
                <div class="row">
                    <div class="col-md-4 text-center position-relative">
<!--                        <div class="card h-100 position-relative">-->
                        <!-- 등급 아이콘 -->
                        <div class="rating-icon position-absolute top-0 end-0 mt-2 me-4 text-white fw-bold"
                             th:switch="${movie.rating}">
                            <span th:case="'12세'" class="bg-warning rounded px-2 py-1">12</span>
                            <span th:case="'15세'" class="bg-orange rounded px-2 py-1">15</span>
                            <span th:case="'19세'" class="bg-danger rounded px-2 py-1">19</span>
                            <span th:case="*" class="bg-success rounded px-2 py-1">ALL</span>
                        </div>
                        <img th:src="@{${movie.posterImageUrl}}" class="img-fluid poster-image" alt="포스터 이미지">
<!--                        </div>-->
                    </div>
                    <div class="col-md-8">
                        <h2 class="mb-3" th:text="${movie.movieName}">영화 제목</h2>
                        <ul class="list-unstyled">
                            <li><strong>등급:</strong> <span th:text="${movie.rating}"></span></li>
                            <li><strong>러닝타임:</strong> <span th:text="${movie.runtime}"></span>분</li>
                            <li><strong>장르:</strong> <span th:text="${movie.genreName}"></span></li>
                            <li><strong>감독:</strong> <span th:text="${movie.directorName}"></span></li>
                            <li><strong>제작사:</strong> <span th:text="${movie.companys}"></span></li>
                            <li><strong>개봉일:</strong> <span th:text="${movie.openDate}"></span></li>
                            <li><strong>누적관객수:</strong> <span th:text="${movie.audiAcc}"></span>명</li>
                            <li><strong>매출액:</strong> <span th:text="${movie.salesAcc}"></span></li>
                        </ul>
                        <hr>
                        <p th:text="${movie.plot}" class="text-muted">줄거리</p>
                        <div class="d-flex gap-3 mt-4">
                            <a href="/" class="btn btn-secondary btn-custom px-4">홈으로</a>
                            <a th:if="${movie.status.name() != 'PREV'}"
                               th:href="@{/reservation(movieId=${movie.id})}"
                               class="btn btn-success btn-custom px-4">예매하기</a>
                            <button th:if="${movie.status.name() == 'PREV'}"
                                    class="btn btn-secondary btn-custom px-4"
                                    disabled>개봉 예정</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 리뷰 목록 카드 -->
        <div class="col-lg-10 mt-5 position-relative">
            <div class="movie-detail-card">
                <h3 class="card-header">한줄 리뷰 & 기대평</h3>
                <br>
                <div class="card-body">
                    <!-- 비밀번호 오류 메시지 출력 -->
                    <div th:if="${errorMessage}" class="alert alert-danger"
                         style="padding: 10px; font-size: 14px; max-width: 200px; margin: 0;
                        position: absolute; top: 0; right: 10px;">
                        <p th:text="${errorMessage}" style="margin: 0;"></p>
                    </div>

                    <div th:if="${#lists.isEmpty(reviews)}" class="text-center">
                        <p class="text-muted">리뷰를 작성해 보세요!</p>
                    </div>
                    <div th:each="review : ${reviews}" class="mb-3">
                        <div class="d-flex align-items-center justify-content-between">
                            <!-- 닉네임 및 별점 -->
                            <div>
                                <strong th:text="${review.nickname}"></strong>
                                (<span style="color: #ffc107;" class="review-stars" th:text="'★'"></span><span th:text="${review.rating}"></span>)
                                <p th:text="${review.content}" class="mb-0"></p>
                            </div>
                            <!-- 삭제 기능 -->
                            <div class="d-flex align-items-center">
                                <form action="/review/delete" method="post" class="d-flex align-items-center gap-2 position-relative">
                                    <input type="password" class="form-control form-control-sm" name="password"
                                           placeholder="비밀번호" style="width: 120px;" required>
                                    <input type="hidden" name="reviewId" th:value="${review.id}">
                                    <input type="hidden" name="movieId" th:value="${movie.id}">
                                    <button type="submit" class="btn btn-danger btn-sm" style="font-size: 14px;">x</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 리뷰 작성 카드 -->
        <div class="col-lg-10 mt-5">
            <div class="movie-detail-card">
                <div class="card-header">리뷰 & 기대평 작성</div>
                <br>
                <div class="card-body">
                    <form action="/review/add" method="post">
                        <input type="hidden" name="movieId" th:value="${movie.id}">
                        <div class="input-inline mb-3">
                            <input type="text" class="form-control" id="nickname" name="nickname" placeholder="닉네임" required>
                            <input type="password" class="form-control" id="password" name="password" placeholder="비밀번호" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">별점</label>
                            <div class="star-rating" id="starRating">
                                <span class="star" data-value="1">★</span>
                                <span class="star" data-value="2">★</span>
                                <span class="star" data-value="3">★</span>
                                <span class="star" data-value="4">★</span>
                                <span class="star" data-value="5">★</span>
                            </div>
                            <input type="hidden" id="rating" name="rating" required>
                        </div>
                        <div class="mb-3">
                            <label for="content" class="form-label">리뷰 내용</label>
                            <textarea class="form-control" id="content" name="content" rows="3" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">작성</button>
                    </form>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    const stars = document.querySelectorAll('.star');
    const ratingInput = document.getElementById('rating');
    const reviewForm = document.querySelector('form[action="/review/add"]');

    // 별점을 선택하면 값이 설정되도록 이벤트 리스너 추가
    stars.forEach(star => {
        star.addEventListener('click', () => {
            const value = parseInt(star.getAttribute('data-value'));
            stars.forEach((s, index) => {
                s.classList.toggle('selected', index < value);
            });
            ratingInput.value = value;
        });
    });

    // 폼 제출 시 별점이 입력되지 않았을 경우 경고 메시지
    reviewForm.addEventListener('submit', (e) => {
        if (!ratingInput.value) {
            e.preventDefault();
            alert('별점을 입력해 주세요!');
        }
    });
</script>

<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
</body>
</html>

<!--<!DOCTYPE html>-->
<!--<html xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>Movie Detail</title>-->
<!--    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">-->
<!--    <style>-->
<!--        .movie-detail-card {-->
<!--            background-color: #f8f9fa;-->
<!--            border-radius: 10px;-->
<!--            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);-->
<!--            padding: 20px;-->
<!--        }-->
<!--        .poster-image {-->
<!--            border-radius: 10px;-->
<!--            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);-->
<!--        }-->
<!--        .btn-custom {-->
<!--            border-radius: 20px;-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--&lt;!&ndash; 공통 헤더 추가 &ndash;&gt;-->
<!--<div th:replace="~{fragments/header :: header}"></div>-->

<!--<div class="container mt-5">-->
<!--    <div class="row justify-content-center">-->
<!--        &lt;!&ndash; 상세보기 카드 &ndash;&gt;-->
<!--        <div class="col-lg-10">-->
<!--            <div class="movie-detail-card">-->
<!--                <div class="row">-->
<!--                    &lt;!&ndash; 영화 포스터 &ndash;&gt;-->
<!--                    <div class="col-md-4 text-center">-->
<!--                        <img th:src="@{${movie.posterImageUrl}}" class="img-fluid poster-image" alt="포스터 이미지">-->
<!--                    </div>-->
<!--                    &lt;!&ndash; 영화 정보 &ndash;&gt;-->
<!--                    <div class="col-md-8">-->
<!--                        <h2 class="mb-3" th:text="${movie.movieName}">영화 제목</h2>-->
<!--                        <ul class="list-unstyled">-->
<!--                            <li><strong>등급:</strong> <span th:text="${movie.rating}"></span></li>-->
<!--                            <li><strong>러닝타임:</strong> <span th:text="${movie.runtime}"></span>분</li>-->
<!--                            <li><strong>장르:</strong> <span th:text="${movie.genreName}"></span></li>-->
<!--                            <li><strong>감독:</strong> <span th:text="${movie.directorName}"></span></li>-->
<!--                            <li><strong>제작사:</strong> <span th:text="${movie.companys}"></span></li>-->
<!--                            <li><strong>개봉일:</strong> <span th:text="${movie.openDate}"></span></li>-->
<!--                            <li><strong>누적관객수:</strong> <span th:text="${movie.audiAcc}"></span>명</li>-->
<!--                            <li><strong>매출액:</strong> <span th:text="${movie.salesAcc}"></span></li>-->
<!--                        </ul>-->
<!--                        <hr>-->
<!--                        <p th:text="${movie.plot}" class="text-muted">줄거리</p>-->
<!--                        <div class="d-flex gap-3 mt-4">-->
<!--                            <a href="/" class="btn btn-secondary btn-custom px-4">홈으로</a>-->
<!--                            &lt;!&ndash; 버튼 상태 조건부 렌더링 &ndash;&gt;-->
<!--                            <a th:if="${movie.status.name() != 'PREV'}"-->
<!--                               th:href="@{/reservation(movieId=${movie.id})}"-->
<!--                               class="btn btn-success btn-custom px-4">예매하기</a>-->
<!--                            <button th:if="${movie.status.name() == 'PREV'}"-->
<!--                                    class="btn btn-secondary btn-custom px-4"-->
<!--                                    disabled>개봉 예정</button>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->

<!--<script th:src="@{/js/bootstrap.bundle.min.js}"></script>-->
<!--</body>-->
<!--</html>-->